<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScript Prelim</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');

        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            
        }

        .backdrop-edit, .backdrop-checkout {
            z-index: 9999;
            position: fixed;
            display: none;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100vh;
            top: 0;
            left: 0;
            background-color: rgba(0, 0, 0, 0.7);
        }

        .edit-page, .checkout-page {
            padding: 20px;
            background-color: #f5f5f5;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            width: 300px;
        }

        .edit-page{
            height: 50vh;
            width: 50%;
            padding: 20px;
        }

        .edit-page input, .checkout-page ul {
            width: 100%;
            margin-bottom: 10px;
        }

        .edit-page input{
            width: 97%;
            padding: 10px;
            font-size: 15px;
        }

        .header, .footer{
            width: 100%;
            height: 10vh;
            font-family: "Poppins", sans-serif;
            font-weight: 700;
            font-style: normal;
            text-align: center;
            align-content: center;
            background: linear-gradient(to right, #E9FF97, #FFD18E, #FFA38F, #FF7EE2);
            background-size: 200% 100%;
            animation: backgroundAnimate 5s ease infinite;

        }

        /* .header{
            background-color: #ACE1AF;
        } */

        .header .head-con{
            display: inline-block;
        }

        .header .head-con h2{
            letter-spacing: 1px;
            border-right: 3px solid;
            width: 100%;
            white-space: nowrap;
            overflow: hidden;
            animation: 
                    typing 2s steps(22),
                    cursor .4s step-end infinite alternate;
        }

        @keyframes cursor{
            50%{border-color: transparent}
        }

        @keyframes typing{
            from {width: 0}
        }


        .footer{
            height: 10.9vh;
            /* background: #ACE1AF; */
        }

        @keyframes backgroundAnimate {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }

        .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: "Poppins", sans-serif;
            font-weight: 500;
            font-style: normal;
        }

        .form-div {
            position: relative;
            padding: 30px;
            background-color: #616161;
            color: white;
            width: 50%;
            height: 71vh;
            transition: .3s ease-in-out;
        }



        .form-div input {
            width: 98%;
            margin-bottom: 10px;
            padding: 8px;
            margin-bottom: 20px;
            font-family: "Poppins", sans-serif;
            font-weight: 400;
            font-style: normal;
        }

        label{
            font-size: 18px;
        }

        .cart-div {
            position: relative;
            text-align: left;
            background-color: #59586e;
            width: 50%;
            padding: 30px;  
            color: white;
            height: 63.8vh;
            overflow: scroll;
            scrollbar-width: none;
            padding-bottom: 83px;
            transition: .3s ease-in-out;
        }


        ul {
            padding: 0;
            list-style: none;
        }

        ul li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background-color: #fff;
            color: black;
            border-radius: 5px;
        }

        button {
            padding: 10px 25px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            font-family: "Poppins", sans-serif;
            font-weight: 400;
            font-style: normal;
            color: white;
            transition: .3s ease-in-out;
        }

        button:hover{
            scale: 1.09;
        }

        .edit-btn{
            background-color: #09d770;
        }

        .cancel, .close-btn, .delete-btn {
            background-color: #e04e1d;
        }


        .save, .confirm-btn{
            background-color: #09d770;
        }
        .addtocart, .checkout{
            background-color: #09d770;
            position: absolute;
            bottom: 4%;
            right: 10%;
        }

        .checkout{
            z-index: 50;
            position: fixed;
            bottom: 15%;
            right: 3.5%;
        }

        .checkout-page{
            overflow: scroll;
            scrollbar-width: none;
            height: 50vh;
            width: 50%;
            padding: 20px;
        }

        h4 {
            display: inline;
        }

        label{
            margin-top: 50px;
        }

        h1{
            font-family: "Poppins", sans-serif;
            font-weight: 700;
            font-style: normal;
        }

        .res h3{
            display: inline-block;
            color: rgb(255, 255, 255);
            margin: 0;
            font-size: 15px;
            

        }

        .res{
            z-index: 50;
            position: fixed;
            bottom: 12%;
        }

        .res .total{
            color: #ef7620;
            font-size: 23px;
        }

        .back{
            z-index: 5;
            position: fixed;
            bottom: 10.8%;
            right: 0;
            height: 13.5vh;
            width: 50%;
            background-color: rgba(0, 0, 0, 0.6);
        }

        .checkout-page h3{
            display: inline-block;
        }

        input[type="checkbox"]{
            cursor: pointer;
        }

        select {
            width: 200px;
            padding: 5px;
            border-radius: 5px;
            background-color: white;
            font-size: 15px;
            font-family: "Poppins", sans-serif;
            font-weight: 400;
            font-style: normal;
            color: #333;
            outline: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        select:hover {
            border-color: #0056b3;
        }

        select:focus {
            border-color: #000000;
            box-shadow: 0 0 5px rgba(79, 81, 83, 0.5);
        }

        /* Style the options */
        option {
            font-size: 16px;
            color: #333;
            background-color: white;
            padding: 10px; /* This will not work consistently across browsers */
        }

        option:hover {
            background-color: #007BFF; /* Changes the background color on hover */
            color: white;
        }

        #p-div{
            display: block;
        }

        #payment{
            margin-bottom: 30px;
        }
    </style>
</head>
<body>

<div class="backdrop-edit">
    <div class="edit-page">
        <h2>Edit Item</h2>
        <hr>
        <label for="edit-item">Edit Item:</label> <br>
        <input type="text" id="edit-item" placeholder="Enter item name"> <br>

        <label for="edit-price">Edit Price:</label> <br>
        <input type="number" id="edit-price" placeholder="Enter price"> <br>

        <label for="edit-quantity">Edit Quantity:</label> <br>
        <input type="number" id="edit-quantity" placeholder="Enter quantity"> <br>

        <button class="cancel">Cancel</button>
        <button class="save">Save</button>
    </div>
</div>

<div class="backdrop-checkout">
    <div class="checkout-page">
        <h2>Checked Out Items</h2>
        <hr>
        <ul id="checked-items"></ul>
        <div>
           <h3>Total: â‚±</h3><h3 id="checkout-total">0</h3><br>
        </div>

        <div class="p-div">
            <label for="payment">Payment Method:</label>
            <select name="payment" id="payment">
                <option>Cash on Delivery</option>
                <option>Bank Transfer</option>
                <option>Gcash</option>
                <option>Maya</option>
                <option>Metamask</option>
                <option>Phantom Wallet</option>
            </select>
        </div>
        
        
        <button class="close-btn">Cancel</button>
        <button class="confirm-btn">Confirm</button>

    </div>
</div>

<div class="header">
    <div class="head-con">
        <h2>Enhanced Shopping Cart</h2>
    </div>
</div>

<div class="container">
    <div class="form-div">
        <h1>Items</h1>
        <hr><br>
        <form id="cart-form">
            <label for="item">Item Name:</label> <br>
            <input type="text" id="item" placeholder="Enter item name" required> <br>

            <label for="price">Item Price:</label> <br>
            <input type="number" id="price" placeholder="Enter item price" required> <br>

            <label for="quantity">Quantity:</label> <br>
            <input type="number" id="quantity" placeholder="Enter item quantity" required> <br>

            <button type="submit" class="addtocart">Add to cart</button>

            <label for="town">Shipping Address: </label>
            <select name="town" id="town">
                <option value="0">Tubigon - Free</option>
                <option value="50">Calape - â‚±50</option>
                <option value="55">Clarin - â‚±55</option>
                <option value="100">Loon - â‚±100</option>
                <option value="150">Sagbayan - â‚±150</option>
                <option value="200">Tagbilaran - â‚±200</option>
                <option value="500">Cebu - â‚±500</option>
                <option value="10000">Japan - â‚±10000</option>
            </select>

        </form>
    </div>

    <div class="cart-div">
        <h1>Your Cart</h1>
        <hr><br>
        <ul id="cart-list"></ul>
        <div class="res">
            <span><h3>Sub-Total: â‚±</h3><h3 id="sub-total">0</h3></span><br>
            <span><h3>Shipping Fee: â‚±</h3><h3 id="shipping-total">0</h3></span><br>
            <span><h3 class="total">Total: â‚±</h3><h3 id="total" class="total">0</h3></span>
        </div>
        <button class="checkout">Checkout</button>
        <div class="back"></div>
    </div>
</div>

<div class="footer"></div>
<script>
    let total = 0;
    let subTotal = 0;
    let shippingTotal = 0;
    let editingItem = null;

    const cartForm = document.getElementById('cart-form');
    const cartList = document.getElementById('cart-list');
    const totalDisplay = document.getElementById('total');
    const editBackdrop = document.querySelector('.backdrop-edit');
    const checkoutBackdrop = document.querySelector('.backdrop-checkout');
    const editItemInput = document.getElementById('edit-item');
    const editPriceInput = document.getElementById('edit-price');
    const editQuantityInput = document.getElementById('edit-quantity');
    const checkoutItems = document.getElementById('checked-items');
    const checkoutTotalDisplay = document.getElementById('checkout-total');
    const subTotalDisplay = document.getElementById('sub-total');
    const shippingTotalDisplay = document.getElementById('shipping-total');
    var confirmCheckOut = false;

    cartForm.addEventListener('submit', (e) => {
        e.preventDefault();

        const itemName = document.getElementById('item').value;
        const itemPrice = parseFloat(document.getElementById('price').value);
        const itemQuantity = parseInt(document.getElementById('quantity').value);
        const town = parseInt(document.getElementById('town').value);
        

        addItemToCart(itemName, itemPrice, itemQuantity, town);
        cartForm.reset();
    });

    cartList.addEventListener('click', (e) => {
        if (e.target.classList.contains('edit-btn')) {
            openEditModal(e.target.closest('li'));
        }

        if (e.target.classList.contains('delete-btn')) {
            deleteItemFromCart(e.target.closest('li'));
            calculateTotal();
        }
    });

    document.querySelector('.cancel').addEventListener('click', () => {
        editBackdrop.style.display = 'none';
        checkoutBackdrop.style.display = 'none';
        editingItem = null;
    });

    document.querySelector('.save').addEventListener('click', () => {
        if (editingItem) {
            updateCartItem(editingItem);
            calculateTotal();
        }
    });

    document.querySelector('.checkout').addEventListener('click', (e) => {
        
        
        checkoutItems.innerHTML = '';
        let checkoutTotal = 0;

        const selectedItems = [];
        document.querySelectorAll('#cart-list li input[type="checkbox"]:checked').forEach(checkbox => {
            const li = checkbox.closest('li');
            const itemName = li.querySelector('.item-name').textContent;
            const shipFee = parseFloat(li.dataset.shipping);
            const itemTotal = parseFloat(li.querySelector('.item-total').textContent.substring(1));
            checkoutTotal += itemTotal  + shipFee;

            const checkoutLi = document.createElement('li');
            checkoutLi.textContent = itemName + ' - â‚±' + itemTotal.toFixed(2);
            checkoutItems.appendChild(checkoutLi);

            selectedItems.push(li);
        });

        checkoutTotalDisplay.textContent = checkoutTotal.toFixed(2);
        if(selectedItems.length > 0){
            checkoutBackdrop.style.display = 'flex';
        }else{
            alert('You selected nothing!');
        }
        
    });

    document.querySelector('.confirm-btn').addEventListener('click', ()=>{
        const selectedItems = document.querySelectorAll('#cart-list li input[type="checkbox"]:checked');

        const totalCheckOut = parseFloat(checkoutTotalDisplay.textContent);

        selectedItems.forEach(checkbox =>{
            const li = checkbox.closest('li');
            li.remove();
        });

        total -= totalCheckOut;
        updateTotal();
     
        checkoutBackdrop.style.display = 'none';
        calculateTotal();

        const paymethod = document.getElementById('payment').value;
        alert(`Checkout Successfull - Payment Method via ${paymethod}`);
    });

    

    document.querySelector('.close-btn').addEventListener('click', () => {
        checkoutBackdrop.style.display = 'none';
    });

    function addItemToCart(name, price, quantity, town) {
        const itemTotal = price * quantity;
        

        const li = document.createElement('li');
        li.innerHTML = `<input type="checkbox" class="item-checkbox"> <span class="item-name">${name}</span> - <span class="item-price">â‚±${price.toFixed(2)}</span> x <span class="item-quantity">${quantity}</span> <span class="item-total">â‚±${itemTotal.toFixed(2)}</span>
            <button class="edit-btn">Edit</button>
            <button class="delete-btn">Delete</button>`;
        li.dataset.price = price;
        li.dataset.quantity = quantity;
        li.dataset.shipping = town;

        cartList.appendChild(li);

        li.querySelector('.item-checkbox').addEventListener('change', calculateTotal)
        
    }

    function openEditModal(item) {
        editingItem = item;
        editItemInput.value = editingItem.querySelector('.item-name').textContent;
        editPriceInput.value = editingItem.dataset.price;
        editQuantityInput.value = editingItem.dataset.quantity;
        editBackdrop.style.display = 'flex';
        editingItem.querySelector('.item-price .item-quantity').addEventListener('change', calculateTotal)
    }

    function updateCartItem(item) {
        const newName = editItemInput.value;
        const newPrice = parseFloat(editPriceInput.value);
        const newQuantity = parseInt(editQuantityInput.value);
        const oldTotal = parseFloat(item.querySelector('.item-total').textContent.substring(1));

        const newTotal = newPrice * newQuantity;

        item.querySelector('.item-name').textContent = newName;
        item.querySelector('.item-total').textContent = 'â‚±' + newTotal.toFixed(2);
        item.querySelector('.item-price').textContent = 'â‚±' + newPrice.toFixed(2);
        item.querySelector('.item-quantity').textContent = newQuantity;
        item.dataset.price = newPrice;
        item.dataset.quantity = newQuantity;

        
        editBackdrop.style.display = 'none';
        editingItem = null;
    }

    function deleteItemFromCart(item) {
        const itemTotal = parseFloat(item.querySelector('.item-total').textContent.substring(1));
        item.remove();
        
    }

    function updateTotal() {
        totalDisplay.textContent = total.toFixed(2);
        subTotalDisplay.textContent = subTotal.toFixed(2);
        shippingTotalDisplay.textContent = shippingTotal.toFixed(2);
    }

    function calculateTotal(){
        total = 0;
        shippingTotal = 0;
        subTotal = 0;
        document.querySelectorAll('#cart-list li input[type="checkbox"]:checked').forEach(checkbox => {
            const li = checkbox.closest('li');
            const itemTotal = parseFloat(li.querySelector('.item-total').textContent.substring(1));
            const shipfee = parseFloat(li.dataset.shipping);
            const tmpTotal = (itemTotal + shipfee);
            subTotal += itemTotal;
            total += tmpTotal;
            shippingTotal += shipfee;
    
        });

        updateTotal();
    }
    
</script>

</body>
</html>
